%!TeX root = ../main.tex
% Add the above to each chapter to make compiling the PDF easier in some editors.

\chapter{Background}\label{chapter:Background}

\section{HPC-node}

- consists of CPU, RAM, GPU, storage, etc.
- cpu has multiple cores and threads
- in short: a PC

\section{PCI-Express}
PCIe, or PCI-Express, shorthand for Peripheral Component Interconnect Express, is a "general-purpose serial I/O interconnect". [cite pciefaq] PCIe, as an interface, allows the CPU to connect with, as the name suggests, peripherals and components. [cite: pcmag] Common components and peripherals include, but are not limited to: Graphics cards, sound cards, video capture cards, WiFi cards, and storage. [cite: HP]
PCIe is designed to replace the ageing PCI (Peripheral Component Interconnect), PCI-X (Peripheral Component Interconnect Extended), and AGP (Accelerated Graphics Port) standards. [cite here: verma/dahiya] These standards are developed, defined, and maintained by the PCI-SIG group, which is a nonprofit organization with 800+ member companies based in Beaverton, Oregon. [cite here: pcisig page] This chapter will briefly introduce the key features and functionality of PCI-Express.

\subsection{Key Features}

PCI-Express is, at its core, a serialized, point-to-point connection that is designed to be processor agnostic, scalable, and backwards compatible with PCI.[cite: lawley] [cite: pciefaq] [cite: pcisig] PCI-Express utilizes a dual-simplex connection to facilitate sending and receiving information concurrently. Additionally, to ensure backwards compatibility with PCI, PCI-Express shares the same memory configuration as PCI, which will be elaborated further upon in section [ref: section]. Further key features include better error handling and data integrity capabilities. [verma] To future-proof the standard, future generations of PCIe are to be designed to be compatible with current PCIe standards. [pcisig site] So far, each generation of PCIe doubled the previous generation's theoretical maximum bandwidth, as seen in table [ref: table]

[table here]


\subsection{Functionality}

\subsubsection{packet}
PCIe, similar to IPv4 or IPv6, utilizes packets to communicate between the host - the CPU - and the device. As shown in figure \ref{fig:packet}, the packet consists of a few different elements, which will be further expanded upon below. 

\begin{figure}
\includegraphics[width = \linewidth]{figures/PCIE-packet}
\caption{An example of a PCI-Express packet [cite source]}
\label{fig:packet}
\end{figure}

\begin{itemize}
\item Start: this is the start component which signals the begin of a packet to the physical layer.
\item Sequence: This two-byte sequence is used by the Data Link Layer to determine the sequence of the packets.
\item Header: The 12 to 16 Byte header will be discussed in further detail in subsection [reference to header]. This component belongs to the Transaction layer.
\item Payload: The PCIe payload. This is optional, however any memory transferred via memory copy operations will have the memory as payload. This also is a part of the Transaction layer.
\item ECRC: a CRC code for error-checking purposes used by the transaction layer.
\item LCRC: a CRC code for error-checking purposes used by the Data Link Layer.
\end{itemize}


\subsubsection{header}
As with IPv4 or IPv6, PCI-Express uses headers to determine the purpose and target of each TLP (Transaction Layer Packet)
However, instead of using IP-addresses, stored in the header, to determine the sender and the receiver, PCIe uses the Requester ID to determine the sender. The Address determines the receiver of the intended packet, as the device memory is memory-mapped into the host address domain to enable the processor's native load or store instructions to work with PCIe devices. [cite oracle website] As seen in Figure \ref{fig:header}, the header has a fixed format, similar to an IPv4 or v6 header. The fields and their uses are briefly explained below.

\begin{figure}
\includegraphics[width = \linewidth]{figures/PCIE-header}
\caption{An example of a memory request header [cite source]}
\label{fig:header}
\end{figure}


\begin{itemize}
\item TC: Traffic Class: this denotes the priority of the packet. A larger value represents a higher priority. [cite book]
\item TD: The TLP Digest field. If TD is set to 1, it indicates that there is additional CRC data in the TLP data. [cite xillybus]
\item Length: more or less self-explanatory: length denotes the length of the payload in Double Words. [cite xillybus]
\item Requester ID: self-explanatory: the ID of the device that requested or sent the packet. [cite xillybus]
\item Tag: The Tag field has the function of a tracking number, as for read requests, the device must copy this value to its response. All outstanding tags must be unique to ensure data integrity. [cite xillybus]
\item DW BE fields: DW BE stands for Double-Word Byte Enable. This denotes which of the bytes in the first / last DWs are valid. [cite xillybus]
\item Address: self-explanatory: The Address to which this packet is addressed, as explained above. Additionally, for read and write requests, this denotes the starting address of the read or write. [cite xillybus]
\item The EP and Attr fields are not further elaborated upon as they are rarely used by PCIe endpoint devices. [cite xillybus]
\end{itemize}



[note: a lot of the specifications are unaccessible to me due to them being locked behind PCI SIG membership, so sources are difficult to find.]
[note2: xillybus is a website source, not sure if it is safe to use. Link: http://xillybus.com/tutorials/pci-express-tlp-pcie-primer-tutorial-guide-1]

\subsection{Topology and Communication}

\subsubsection{Topology}
There are four significant components to be mentioned when discussing the topology of a PCI-Express based system. PCIe endpoints, switches, bridges, and a root complex. 
The communication between CPU cores and memory controllers to the PCIe endpoint is handled by the PCIe root complex. This communication can be routed through (but does not require) PCIe switches. PCIe switches allow for cascading connections, however do not benefit the total bandwidth, which is limited by the PCIe root complex in a CPU. [cite: nakamura et al] 
Bridges are used to connect legacy PCI and PCI-X devices with the PCIe root complex. [cite: pciefaq]
Figure \ref{fig:topology} shows an example PCIe configuration of an Intel-based processor.

\begin{figure}
\includegraphics[width = \linewidth]{figures/PCIE-topology}
\caption{PCIe configuration on an Intel-based system [cite source]}
\label{fig:topology}
\end{figure}
\subsubsection{Memory Management}

The PCIe memory structure is, due to compatibility reasons, the same as the memory structure found in the older PCI standard. This divides the device memory into three major parts for addressing: [cite: book]
\begin{itemize}
\item Configuration
\item Memory
\item IO
\end{itemize}

The configuration address space enables software to both identify and correctly configure the device, and is defined by its bus number and device number. [cite: oracle]
The memory address space is where the storage and registers of a PCIe device is mapped. [cite: book] This memory space is also memory-mapped to the host address domain for ease of access by the CPU. [cite: oracle] 
The IO address space is a place dedicated to accessing the internal registers / storage of a PCIe or PCI device. However, this is mostly deprecated in PCIe as the internal registers and storage of said devices are simply mapped into the memory address space instead. It is now common practice to map the same set of registers in both memory and IO address space. The PCIe specification discourages use of the IO space, which indicates that it remains here solely for legacy support purposes. [cite: book]

\subsubsection{Links and Lanes}

\begin{itemize}
\item lane, link, link width (graphic)
\end{itemize}

\subsection{Revisions and Further Specifications}

\begin{itemize}
\item mention gen 5 and 6
\item gen6 paper
\item other formfactors: thunderbolt / nvm-express
\end{itemize}

\section{Graphics Processing Units}


\subsection{What are GPUs}
To begin with, it should be noted that the term graphics processing unit (GPU) does not equate to a graphics card. A GPU is a specialized processing unit primarily designed for parallel processing and accelerating workloads that require parallel processing. [cite: intel] A graphics card, on the other hand, is the add-in card that features a PCI-Express link to facilitate communication between CPU and GPU, dedicated memory and power delivery for the GPU, and the GPU itself. It should also be noted that the graphics card usually has its own dedicated PCB. There are also integrated GPUs, which can be embedded alongside the CPU.  These integrated GPUs are usually less powerful compared to discrete GPUs. [cite: intel]

\subsection{Uses of GPUs}

GPUs originally began as, as their names suggest, dedicated graphics accelerators

\begin{itemize}
\item In the past: only for real-time 3D graphics
\item now: more or less general-purpose GPUs as accelerators for several different use-cases and workloads
\item Gaming / Video Editing / Content Creation
\item Machine Learning: Tensor cores [nvidia]
\item raw compute performance for single-precision [arxiv paper]
\item AI and HPC tasks here, do further research (?)
\end{itemize}

\subsection{GPU Memory}

- same addressing as other pcie endpoints [ref section]
- faster VRAM and higher bandwidths compared to main memory
-

\section{CUDA}

CUDA is a closed source API developed and maintained by Nvidia for use with their GPUs and graphics cards. 

\subsection{Features}

\begin{itemize}
\item nvidia's programming-API
\item closed-source
\item offers way for the CPU to communicate with and to program nvidia GPUs
\item use the .cu extension, called kernels (why? not sure.)
\item features: memory management, data movement, etc. -> subsection?
\item more features: Libraries for several different features such as linear algebra, signal processing, image processing [cuda11 features nvidia]
\item CUDA is the preferred API for this thesis (reasons?)
\end{itemize}


